resources:
  jobs:
    snowflake_ingestion_job:
      name: "snowflake_ingestion_job"

      permissions: 
        - level: CAN_MANAGE_RUN
          group_name: migration-accelerator-devs

        
      tasks:
        - task_key: snowflake_ingestion_task
          # Run on existing cluster "data-migration"
          existing_cluster_id: 1214-215558-eghymads
          python_wheel_task:
            entry_point: snowpark-reader
            package_name: migration_accelerator_package
          environment_key: "serverless_wheel"
        
        - task_key: snowflake_ingestion_validation_task
          depends_on:
            - task_key: snowflake_ingestion_task
          existing_cluster_id: 1214-215558-eghymads
          python_wheel_task:
            entry_point: snowflake-validator
            package_name: migration_accelerator_package
          environment_key: "serverless_wheel"
        
        - task_key: grant_flattening_task
          depends_on:
            - task_key: snowflake_ingestion_task
          existing_cluster_id: 1214-215558-eghymads
          python_wheel_task:
            entry_point: grant-transformer
            package_name: migration_accelerator_package
          environment_key: "serverless_wheel"
              
      # Using existing cluster "data-migration" (ID: 1214-215558-eghymads); no job_clusters or spark_version needed.

      environments:
        - environment_key: "serverless_wheel"
          spec:
            environment_version: "4"
            dependencies:
              - "../dist/*.whl"
              
      timeout_seconds: 3600
      max_concurrent_runs: 1